---
title: 一般业务场景下Redis键驱逐策略
date: 2024-12-17 10:30:00 +0800
categories: [nosql, redis]
tags: [redis,nosql]     
---

## 一般业务场景定义
这里指的的是多个团队共同使用同一redis实例下情况下，其存储的内容可能包括缓存、配置有过期时间的临时存储数据、分布式锁信息等。

## Redis内存不足时的驱逐策略
1. 由于redis中可能存储有分布式锁、临时存储等对业务运行十分重要的数据。这部分数据不应在内存不足是被自动删除。为了区分缓存数据和其他数据，可以在团队或公司内部对key的命名进行规范：
- 缓存数据统一以“cache:”开头
- 分布式锁数据统一以“lock:"开头
- 自动过期的临时存储数据统一以”db:“开头
  
2. 报错redis默认驱逐策略（内存不足时抛出异常）
3. 通过监控手段探测到redis内存剩余空间将要不足时（在实际触发驱逐策略前），通过程序使用scan命令访问”cache:“开头的缓存数据进行删除直至剩余空间充足。也可以更近一步在scan过程中利用PriorityQueue根据ttl生成大顶堆。找出剩余存活时间最短的top-k个键进行删除。